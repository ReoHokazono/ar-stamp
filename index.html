<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">    
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>    
    <script src="https://aframe.io/releases/0.6.1/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/jeromeetienne/AR.js/1.6.0/aframe/build/aframe-ar.js"> </script>
    <link rel="stylesheet" href="style/main.css">
    <title>M科プロジェクト スタンプラリー</title>
</head>

<body>
    <a-scene embedded arjs="trackingMethod:best; debugUIEnabled:false;">                 
        
        <a-marker preset="custom" type="pattern" url="marker/m01.patt" markerid="1" >
            <a-box position="0 0.7 0" color="#742DC0" >
                <a-animation
                    attribute="rotation"
                    from="0 0 0"
                    to="0 0 360"
                    dur="4000"
                    easing="linear"
                    repeat="indefinite"
                    
                ></a-animation>
            </a-box>
            <a-text 
                value="Control\nEngineering\nLab" 
                position="0 0.7 -0.85" 
                align="center" 
                rotation="-90 0 0" 
                color="#FFFFFF"
                height="1.2"
                side="double"
            >
                <a-animation
                    attribute="rotation"
                    from="0 -90 90"
                    to="360 -90 90"
                    dur="4000"
                    easing="linear"
                    repeat="indefinite"
                ></a-animation>
            </a-text>
        </a-marker>     
        
        <a-marker preset="custom" type="pattern" url="marker/m02.patt" markerid="2" >
            <a-box position="0 0.7 0" color="#2058F0" >
                <a-animation
                    direction="alternate"
                    attribute="position"
                    from="0 0 0"
                    to="0 0 -0.5"
                    dur="1700"
                    easing="ease"
                    repeat="indefinite"
                ></a-animation>

                <a-animation
                    attribute="rotation"
                    from="0 0 0"
                    to="0 0 360"
                    dur="4000"
                    easing="linear"
                    repeat="indefinite"
                ></a-animation>
            </a-box>
            <a-text 
                value="MICRO\nDEVICE\nLAB" 
                position=" 0 0 -0.9" 
                align="center" 
                rotation="-90 0 0" 
                color="#FFFFFF"
                height="1.2"
            >
                <a-animation
                direction="alternate"
                attribute="position"
                from="0 0 -0.9"
                to="0 0 -1.4"
                dur="1700"
                easing="ease"
                repeat="indefinite"
                ></a-animation>
            </a-text>
        </a-marker>

        <a-marker preset="custom" type="pattern" url="marker/m03.patt"  markerid="3">
            <a-box position="0 0.7 0" color="#FE5196" >
                <a-animation
                    direction="alternate"
                    attribute="material.color"
                    from="#F77062"
                    to="#FE5196"
                    dur="1700"
                    easing="ease"
                    repeat="indefinite"
                ></a-animation>
            </a-box>
            <a-text 
                value="Fluid\nEngineering\nLab" 
                position=" 0 1.25 0" 
                align="center" 
                rotation="-90 0 0" 
                color="#FFFFFF"
                height="1.2"
            ></a-text>
        </a-marker>

        <a-marker preset="custom" type="pattern" url="marker/m04.patt"  markerid="4">
            <a-box 
            position="0 0.7 0" 
            color="#FF5858"
            wireframe="true"
            wireframe-linewidth="3"
            >
            </a-box>
            <a-text 
                value="Strength\nof Materials\nLab" 
                position=" 0 1.25 0" 
                align="center" 
                rotation="-90 0 0" 
                color="#FFFFFF"
                height="1.2"
            ></a-text>
        </a-marker>

        <a-marker preset="custom" type="pattern" url="marker/m05.patt"  markerid="5">
            <a-box position="0 0.7 0" color="#37ECBA" >
            </a-box>
            <a-text 
                value="E and R\nSupport\nCenter" 
                position=" 0 1.25 0" 
                align="center" 
                rotation="-90 0 0" 
                color="#FFFFFF"
                height="1.2"
            ></a-text>
        </a-marker>

        <a-marker preset="custom" type="pattern" url="marker/m06.patt" markerid="6">
            <a-box position="0 0.7 0" color="#2575FC" >
                <!-- <a-animation
                    attribute="rotation"
                    from="0 0 0"
                    to="0 360 0"
                    dur="4000"
                    easing="linear"
                    repeat="indefinite"
                > -->
            </a-box>
            <a-text 
                value="Kinematics\nEngineering\nLab" 
                position=" 0 1.25 0" 
                align="center" 
                rotation="-90 0 0" 
                color="#FFFFFF"
                height="1.2"
            ></a-text>
        </a-marker>

        <a-marker preset="custom" type="pattern" url="marker/m07.patt" markerid="7">
            <a-box 
                position="0 0.7 0" 
                color="#007ADF" 
                wireframe="true"
                wireframe-linewidth="3">
            </a-box>
            <a-text 
                value="Biomedical\nEngineering\nLab" 
                position=" 0 1.25 0" 
                align="center" 
                rotation="-90 0 0" 
                color="#FFFFFF"
                height="1.2"
                font="sourcecodepro"
            ></a-text>
        </a-marker>

        

        <a-entity camera></a-entity>
    </a-scene>
    <div id="main-container">        
        <div id="camera-container" class="tab-container" v-show="cameraSelected">
            <!-- <div id="stamp-button-outer">
                    <div id="stamp-button-box">
                            <div id="stamp-button-label">STAMP!</div>
                    </div>
            </div> -->
        </div>
        
        <div id="stamp-container" class="tab-container" v-show="stampSelected">
            <div class="tab-title">スタンプ帳</div>

            <div id="stamp-num-text">残り7ヶ所です</div>
            <div id="stamp-complete"><img src="images/stamps/complete.png" alt="" id="stamp-complete-img"></div>
            <div class="stamp-card-outer">
                <div class="stamp-card">
                    <img src="images/stamps/empty.png" alt="" class="stamp-image" id="stamp-img-1">
                    <div class="stamp-label">制御工学実験室</div>
                </div>
            </div>

            <div class="stamp-card-outer">
                    <div class="stamp-card">
                        <img src="images/stamps/empty.png" alt="" class="stamp-image" id="stamp-img-2">
                        <div class="stamp-label">マイクロデバイス実験室</div>
                    </div>
            </div>

            <div class="stamp-card-outer">
                    <div class="stamp-card">
                        <img src="images/stamps/empty.png" alt="" class="stamp-image" id="stamp-img-3">
                        <div class="stamp-label">流体力学実験室</div>
                    </div>
            </div>

            <div class="stamp-card-outer">
                    <div class="stamp-card">
                        <img src="images/stamps/empty.png" alt="" class="stamp-image" id="stamp-img-4">
                        <div class="stamp-label">材料力学実験室</div>
                    </div>
            </div>


            <div class="stamp-card-outer">
                    <div class="stamp-card">
                        <img src="images/stamps/empty.png" alt="" class="stamp-image" id="stamp-img-5">
                        <div class="stamp-label">教育研究支援センター</div>
                    </div>
                </div>
    
                <div class="stamp-card-outer">
                        <div class="stamp-card">
                            <img src="images/stamps/empty.png" alt="" class="stamp-image" id="stamp-img-6">
                            <div class="stamp-label">機構学実験室</div>
                        </div>
                </div>

                <div class="stamp-card-outer">
                        <div class="stamp-card">
                            <img src="images/stamps/empty.png" alt="" class="stamp-image" id="stamp-img-7">
                            <div class="stamp-label">医療福祉工学実験室</div>
                        </div>
                </div>
    
             
                <div class="footer-margin"></div>
        </div>

        <div id="map-container" class="tab-container" v-show="mapSelected">
            <div class="tab-title">マップ</div>
        </div>

        <div id="info-container" class="tab-container" v-show="infoSelected">
            <div class="tab-title">このWEBアプリについて</div>
            <div id="copyright">
                    Copyright © 2018 <br>
                    National Institute of Technology, Numazu Colledge <br>
                   Department of Mechanical Engineering . <br>
                   All rights reserved.
            </div>
        </div>

        <div id="tab-bar">
            <div 
            class="tab-item-box" 
            v-bind:class="{ 'tab-active' : cameraSelected }" 
            v-on:click="tabSelected('camera')">
                <div class="tab-item-icon" id="icon-camera"></div>
                <div class="tab-item-label">カメラ</div>
            </div>
            <div 
            class="tab-item-box" 
            v-bind:class="{ 'tab-active' : stampSelected }" 
            v-on:click="tabSelected('stamp')">
                <div class="tab-item-icon" id="icon-stamp"></div>
                <div class="tab-item-label">スタンプ</div>
            </div>
            <div 
            class="tab-item-box" 
            v-bind:class="{ 'tab-active' : mapSelected }" 
            v-on:click="tabSelected('map')">
                <div class="tab-item-icon" id="icon-map"></div>
                <div class="tab-item-label">マップ</div>
            </div>
            <div 
            class="tab-item-box" 
            v-bind:class="{ 'tab-active' : infoSelected }" 
            v-on:click="tabSelected('info')">
                <div class="tab-item-icon" id="icon-info"></div>
                <div class="tab-item-label">情報</div>
            </div>
        </div>
    </div>
    <script>
        Vue.config.ignoredElements = [
        "a-scene",
        "a-entity",
        "a-camera",
        "a-box",
        "a-marker"
        ]

        const app = new Vue({
            el: "#main-container",
            data: {
                cameraSelected: true,
                stampSelected: false,
                mapSelected: false,
                infoSelected: false,
                video: {}
            },
            methods: {
                tabSelected(tab){
                    this.cameraSelected = false
                    this.stampSelected = false
                    this.mapSelected = false
                    this.infoSelected = false

                    switch (tab) {
                        case "camera":
                            this.cameraSelected = true
                            break
                        case "stamp":
                            this.stampSelected = true
                            break
                        case "map":
                            this.mapSelected = true
                            break
                        default:
                            this.infoSelected = true
                            break
                    }
                }
            },  
            mounted(){
            }
        })           
 
        window.addEventListener("scroll",()=>{
            document.body.scrollLeft = 0
        },false)

        let displayTimeCount = 0
        let markerIsShown = false
        let displayedMarkerId = 0
        const fullPoints = 7

        for (let index = 1; index <= 7; index++) {
            if (localStorage.getItem("s" + String(index)) == "1"){
                document.getElementById("stamp-img-" + String(index)).src = "images/stamps/s" + String(index)+ ".png"
            }
            
        }

        let currentPoints = Number(localStorage.getItem("visitedPoints"))
        if (currentPoints == null){
            currentPoints = 0
        }

        const restPoints = fullPoints - currentPoints
        if (restPoints == 0){
            document.getElementById("stamp-num-text").innerText = "コンプリートしました!"
            document.getElementById("stamp-complete").style.display = "block"
        }else{
            const displayText = "残り" + String(restPoints) + "ヶ所です"
            document.getElementById("stamp-num-text").innerText = displayText
        }

        setInterval(()=>{
            let elements = document.getElementsByTagName("a-marker")
            markerIsShown = false
            for (let index = 0; index < elements.length; index++) {
                const element = elements[index];
                if (element.object3D.visible) {
                    displayTimeCount++
                    displayedMarkerId = Number(element.getAttribute("markerid"))
                    markerIsShown = true
                }
            }

            if (!markerIsShown){
                displayTimeCount = 0
            }
            
            if (displayTimeCount == 8 && markerIsShown ){
                const alreadyDetected = localStorage.getItem("s" + String(displayedMarkerId),"1")
                if (alreadyDetected) { return }

                let currentPoints = Number(localStorage.getItem("visitedPoints"))
                if (currentPoints == null){
                    currentPoints = 0
                }
                currentPoints++
                localStorage.setItem("visitedPoints",String(currentPoints))
                const restPoints = fullPoints - currentPoints

                let displayText = ""
                if (restPoints == 0){
                    document.getElementById("stamp-num-text").innerText = "コンプリートしました!"
                    document.getElementById("stamp-complete").style.display = "block"
                }else{
                    const displayText = "残り" + String(restPoints) + "ヶ所です"
                    document.getElementById("stamp-num-text").innerText = displayText
                }
                swal({
                    title:"スタンプしました!",
                    text: displayText,
                    content: {
                    element: "img",
                    attributes: {
                        src:"images/stamps/s" + String(displayedMarkerId)+ ".png",
                        style:"width:90%"
                        }
                    }
                }).then(()=> {
                    if (restPoints == 0){
                        swal({
                            title:"コンプリートしました!",
                            text: displayText,
                            content: {
                                element: "img",
                                attributes: {
                                src:"images/stamps/complete.png",
                                style:"width:90%"
                            }
                    }
                })
                    }
                })


                localStorage.setItem("s" + String(displayedMarkerId),"1")
                document.getElementById("stamp-img-" + String(displayedMarkerId)).src = "images/stamps/s" + String(displayedMarkerId)+ ".png"
            }
        },100)
        
        //画像キャッシュ
        for (let index = 1; index <= fullPoints; index++) {
            let image = new Image()
            image.src = "images/stamps/s" + String(index)+ ".png"
        }
        let image = new Image()
        image.src = "images/stamps/complete.png"
    </script>
</body>
</html>